/**
 * @license
 * Copyright (c) 2014, 2022, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojvcomponent","preact","jquery","ojs/ojanimation","ojs/ojdomutils","ojs/ojcore-base","ojs/ojpopup","ojs/ojdrawerutils"],function(e,t,s,r,a,n,o,i,l){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var d,h=function(e,t,s,r){var a,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(o=(n<3?a(o):n>3?a(t,s,o):a(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o};const p=oj,D=p.PopupService,w=p.ZOrderUtils;e.DrawerLayout=d=class extends s.Component{constructor(){super(...arguments),this.rootRef=s.createRef(),this.startWrapperRef=s.createRef(),this.startRef=s.createRef(),this.endWrapperRef=s.createRef(),this.endRef=s.createRef(),this.bottomWrapperRef=s.createRef(),this.bottomRef=s.createRef(),this.middleSectionRef=s.createRef(),this.mainSectionRef=s.createRef(),this.startClosedWithEsc=!1,this.endClosedWithEsc=!1,this.bottomClosedWithEsc=!1,this.overlayDrawerResizeListener=null,this.reflowDrawerResizeListener=null,this.handleResize=!0,this.state={startOpened:this.props.startOpened,endOpened:this.props.endOpened,bottomOpened:this.props.bottomOpened,startDisplay:this.props.startDisplay,endDisplay:this.props.endDisplay,bottomDisplay:this.props.bottomDisplay,startShouldChangeDisplayMode:!1,endShouldChangeDisplayMode:!1,bottomShouldChangeDisplayMode:!1,startStateToChangeTo:null,endStateToChangeTo:null,bottomStateToChangeTo:null,viewportResolvedDisplayMode:this.getViewportResolvedDisplayMode(),lastlyOpenedDrawer:l.DrawerConstants.stringStart},this.handleKeyDown=(e,t)=>{const s=this.getDrawerResolvedDisplayMode(e);t.key!==l.DrawerConstants.keys.ESC||s!==l.DrawerConstants.stringOverlay&&s!==l.DrawerConstants.stringFullOverlay||(this[this.edgeToClosedWithEsc(e)]=!0,this.selfClose(e))},this.getRefToAnimate=e=>this.getDrawerResolvedDisplayMode(e)===l.DrawerConstants.stringReflow?this.getDrawerWrapperRef(e):this.getDrawerRef(e),this.overlayDrawerResizeCallback=e=>{r(this.getDrawerRef(e).current).position(this.getDrawerPosition(e))},this.reflowDrawerResizeCallback=e=>{[l.DrawerConstants.stringStart,l.DrawerConstants.stringEnd].indexOf(e)>-1&&this.setBottomOverlayDrawerWidth()},this.lockResizeListener=()=>{this.handleResize&&(this.handleResize=!1,setTimeout(()=>{if(this.handleResize=!0,this.state.viewportResolvedDisplayMode!==this.getViewportResolvedDisplayMode()){const e={};[l.DrawerConstants.stringStart,l.DrawerConstants.stringEnd].forEach(t=>{this.isDrawerOpened(t)&&"auto"===this.state[this.edgeToDisplayName(t)]&&(e[this.edgeToShouldChangeDisplayMode(t)]=!0)}),Object.keys(e).length>0&&this.setState(e)}},l.DrawerConstants.animationDuration+50))},this.resizeHandler=()=>{if(this.handleResize){const e=this.state.viewportResolvedDisplayMode,t=this.getViewportResolvedDisplayMode();this.setBottomOverlayDrawerWidth();let s=!1;const r={};e!==t&&(this.lockResizeListener(),[l.DrawerConstants.stringStart,l.DrawerConstants.stringEnd,l.DrawerConstants.stringBottom].forEach(e=>{this.isDrawerOpened(e)&&"auto"===this.state[this.edgeToDisplayName(e)]&&(s=!0,r[this.edgeToShouldChangeDisplayMode(e)]=!0)}),!1===s&&(r.viewportResolvedDisplayMode=t)),Object.keys(r).length>0&&this.setState(r)}},this.getDrawerPosition=e=>{const t=`${e===l.DrawerConstants.stringBottom?l.DrawerConstants.stringStart:e} ${e===l.DrawerConstants.stringBottom?l.DrawerConstants.stringBottom:l.DrawerConstants.stringTop}`;let s={my:t,at:t,of:this.mainSectionRef.current,collision:"none"};return oj.PositionUtils.normalizeHorizontalAlignment(s,l.DrawerUtils.isRTL())}}static getDerivedStateFromProps(e,t){const s={};return t.startOpened&&e.startDisplay!==t.startDisplay?(s[`${l.DrawerConstants.stringStart}${l.DrawerConstants.stringStateToChangeTo}`]={startDisplay:e.startDisplay},s):t.endOpened&&e.endDisplay!==t.endDisplay?(s[`${l.DrawerConstants.stringEnd}${l.DrawerConstants.stringStateToChangeTo}`]={endDisplay:e.endDisplay},s):t.bottomOpened&&e.bottomDisplay!==t.bottomDisplay?(s[`${l.DrawerConstants.stringBottom}${l.DrawerConstants.stringStateToChangeTo}`]={bottomDisplay:e.bottomDisplay},s):(e.startOpened!==t.startOpened&&(s.startOpened=e.startOpened,e.startOpened&&(s.lastlyOpenedDrawer=l.DrawerConstants.stringStart)),e.endOpened!==t.endOpened&&(s.endOpened=e.endOpened,e.endOpened&&(s.lastlyOpenedDrawer=l.DrawerConstants.stringEnd)),e.bottomOpened!==t.bottomOpened&&(s.bottomOpened=e.bottomOpened,e.bottomOpened&&(s.lastlyOpenedDrawer=l.DrawerConstants.stringBottom)),e.startDisplay!==t.startDisplay&&(s.startDisplay=e.startDisplay),e.endDisplay!==t.endDisplay&&(s.endDisplay=e.endDisplay),e.bottomDisplay!==t.bottomDisplay&&(s.bottomDisplay=e.bottomDisplay),0===Object.keys(s).length?null:s)}render(e){let r=this.getDrawer(l.DrawerConstants.stringStart),a=this.getDrawer(l.DrawerConstants.stringEnd),n=this.getDrawer(l.DrawerConstants.stringBottom);return s.h(t.Root,{ref:this.rootRef},r,s.h("div",{ref:this.middleSectionRef,class:l.DrawerConstants.middleSectionSelector},s.h("div",{ref:this.mainSectionRef,class:l.DrawerConstants.mainContentSelector},e.children),n),a)}getDrawer(e){const t=this.getDrawerResolvedDisplayMode(e),r=t===l.DrawerConstants.stringOverlay||t===l.DrawerConstants.stringFullOverlay,a=this.props.role||r&&"dialog",n=r?-1:void 0;return this.isDrawerOpened(e)||this.wasDrawerOpenedInPrevState(e)||this.wasDrawerClosedWithEsc(e)?s.h("div",{ref:this.getDrawerWrapperRef(e),class:this.getDrawerWrapperStyleClasses(e)},s.h("div",{ref:this.getDrawerRef(e),role:a,tabIndex:n,class:this.getDrawerStyleClasses(e),onKeyDown:t=>this.handleKeyDown(e,t)},this.getDrawerContent(e))):null}isDrawerOpened(e){return this.state[this.edgeToStateOpenedName(e)]}wasDrawerOpenedInPrevState(e){return this[this.edgeToPrevStateOpenedName(e)]}wasDrawerClosedWithEsc(e){return this[this.edgeToClosedWithEsc(e)]}getDrawerWrapperRef(e){switch(e){case l.DrawerConstants.stringStart:return this.startWrapperRef;case l.DrawerConstants.stringEnd:return this.endWrapperRef;case l.DrawerConstants.stringBottom:return this.bottomWrapperRef}}getDrawerRef(e){switch(e){case l.DrawerConstants.stringStart:return this.startRef;case l.DrawerConstants.stringEnd:return this.endRef;case l.DrawerConstants.stringBottom:return this.bottomRef}}getDrawerContent(e){switch(e){case l.DrawerConstants.stringStart:return this.props.start;case l.DrawerConstants.stringEnd:return this.props.end;case l.DrawerConstants.stringBottom:return this.props.bottom}}getDrawerWrapperStyleClasses(e){return`${l.DrawerConstants.stringOjDrawer}${l.DrawerConstants.charDash}${l.DrawerConstants.stringReflow}-wrapper `+this.getDrawerStyleClasses(e)}getDrawerStyleClasses(e){let t;switch(this.getDrawerResolvedDisplayMode(e)){case l.DrawerConstants.stringReflow:t={[l.DrawerConstants.styleDisplayMode(l.DrawerConstants.stringReflow)]:!0};break;case l.DrawerConstants.stringOverlay:t={[l.DrawerConstants.styleDisplayMode(l.DrawerConstants.stringOverlay)]:!0};break;case l.DrawerConstants.stringFullOverlay:t={[l.DrawerConstants.styleDisplayMode(l.DrawerConstants.stringOverlay)]:!0,[l.DrawerConstants.styleDisplayMode(l.DrawerConstants.stringFullOverlay)]:!0}}return l.DrawerUtils.getStyleClassesMapAsString(Object.assign(t,l.DrawerUtils.getCommonStyleClasses(e)))}getDrawerResolvedDisplayMode(e){const t=this.edgeToDisplayName(e);return"auto"===this.state[t]?this.state.viewportResolvedDisplayMode:this.state[t]===l.DrawerConstants.stringReflow?l.DrawerConstants.stringReflow:this.state[t]===l.DrawerConstants.stringOverlay?this.state.viewportResolvedDisplayMode===l.DrawerConstants.stringFullOverlay?l.DrawerConstants.stringFullOverlay:l.DrawerConstants.stringOverlay:void 0}getViewportResolvedDisplayMode(){const e=l.DrawerUtils.getViewportWidth();return e>=l.DrawerConstants.displayTypeChangeThreshold?l.DrawerConstants.stringReflow:e<l.DrawerConstants.displayTypeChangeThreshold&&e>=l.DrawerConstants.fullWidthDrawerChangeThreshold?l.DrawerConstants.stringOverlay:l.DrawerConstants.stringFullOverlay}selfClose(e){var t,s,r,a,n,o;e===l.DrawerConstants.stringStart&&(null===(s=(t=this.props).onStartOpenedChanged)||void 0===s||s.call(t,!1)),e===l.DrawerConstants.stringEnd&&(null===(a=(r=this.props).onEndOpenedChanged)||void 0===a||a.call(r,!1)),e===l.DrawerConstants.stringBottom&&(null===(o=(n=this.props).onBottomOpenedChanged)||void 0===o||o.call(n,!1))}setDrawerFocus(e){const t=this.getDrawerRef(e),s=t.current.querySelectorAll("[autofocus]"),{length:r,0:a}=s;if(r>0)return void a.focus();const n=t.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), video');let o=t.current;if(n.length)for(let e=0;e<n.length;e++)if(!0!==n[e].disabled){o=n[e];break}o.focus()}componentDidUpdate(e,t){this.handleComponentUpdate(t)}componentDidMount(){if(this.startOpenedPrevState=this.props.startOpened,this.endOpenedPrevState=this.props.endOpened,this.bottomOpenedPrevState=this.props.bottomOpened,window.addEventListener(l.DrawerConstants.stringResize,()=>{this.resizeHandler()}),d.defaultProps.startOpened!=this.props.startOpened||d.defaultProps.endOpened!=this.props.endOpened||d.defaultProps.bottomOpened!=this.props.bottomOpened){const e=Object.assign({},this.state);e.startOpened=!1,e.endOpened=!1,e.bottomOpened=!1,this.handleComponentUpdate(e)}}componentWillUnmount(){window.removeEventListener(l.DrawerConstants.stringResize,()=>{this.resizeHandler()})}handleComponentUpdate(e){let t=[l.DrawerConstants.stringStart,l.DrawerConstants.stringEnd,l.DrawerConstants.stringBottom];t=t.filter(e=>e!=this.state.lastlyOpenedDrawer),this.openOrCloseDrawer(t[0],e),this.openOrCloseDrawer(t[1],e),this.openOrCloseDrawer(this.state.lastlyOpenedDrawer,e)}openOrCloseDrawer(e,t){const s=this.edgeToStateOpenedName(e);if(this.isDrawerOpened(e)!=t[s]||this.shouldDrawerChangeDisplayMode(e)||this.isDrawerOpened(e)&&t[s]){this.isDrawerOpened(e)!=t[s]&&(this[this.edgeToPrevStateOpenedName(e)]=this.isDrawerOpened(e));this.getDrawerResolvedDisplayMode(e)===l.DrawerConstants.stringReflow?this.openOrCloseReflowDrawer(e,t):this.openOrClosePopupDrawer(e,t)}}openOrCloseReflowDrawer(e,t){!1===this.isDrawerOpened(e)||this.shouldDrawerChangeDisplayMode(e)||this.getStateToChangeTo(e)?this.animateClose(e).then(()=>{if(n.removeResizeListener(this.getDrawerRef(e).current,this.reflowDrawerResizeListener),this.reflowDrawerResizeListener,this.getStateToChangeTo(e)){const t={},s={};s[this.edgeToStateToChangeTo(e)]=null,Object.assign(t,this.getStateToChangeTo(e),s),this.setState(t)}else if(this.shouldDrawerChangeDisplayMode(e)){const t={};t[this.edgeToShouldChangeDisplayMode(e)]=!1,t.viewportResolvedDisplayMode=this.getViewportResolvedDisplayMode(),this.setState(t)}else this.wasDrawerOpenedInPrevState(e)||(this.forceUpdate(),setTimeout(()=>{this.setBottomOverlayDrawerWidth()},0))}).then(()=>{this.setBottomOverlayDrawerWidth()}):this.isDrawerOpened(e)&&(!1===t[this.edgeToStateOpenedName(e)]||t[this.edgeToShouldChangeDisplayMode(e)]||t[this.edgeToDisplayName(e)]!=this.state[this.edgeToDisplayName(e)])&&this.animateOpen(e).then(()=>{this.setBottomOverlayDrawerWidth(),null===this.reflowDrawerResizeListener&&(this.reflowDrawerResizeListener=this.reflowDrawerResizeCallback.bind(this,e)),n.addResizeListener(this.getDrawerRef(e).current,this.reflowDrawerResizeListener,50,!0)})}animateOpen(e){return this.getDrawerResolvedDisplayMode(e)===l.DrawerConstants.stringReflow?a.expand(this.getRefToAnimate(e).current,l.DrawerUtils.getAnimationOptions("expand",e)):a.slideIn(this.getRefToAnimate(e).current,l.DrawerUtils.getAnimationOptions(l.DrawerConstants.stringSlideIn,e))}animateClose(e){return this.getDrawerResolvedDisplayMode(e)===l.DrawerConstants.stringReflow?a.collapse(this.getRefToAnimate(e).current,l.DrawerUtils.getAnimationOptions("collapse",e)):a.slideOut(this.getRefToAnimate(e).current,l.DrawerUtils.getAnimationOptions(l.DrawerConstants.stringSlideOut,e))}edgeToStateOpenedName(e){return`${e}${l.DrawerUtils.capitalizeFirstChar(l.DrawerConstants.stringOpened)}`}edgeToPrevStateOpenedName(e){return`${e}${l.DrawerUtils.capitalizeFirstChar(l.DrawerConstants.stringOpened)}${l.DrawerConstants.stringPrevState}`}edgeToShouldChangeDisplayMode(e){return`${e}${l.DrawerConstants.stringShouldChangeDisplayMode}`}edgeToClosedWithEsc(e){return`${e}${l.DrawerConstants.stringClosedWithEsc}`}edgeToDisplayName(e){return`${e}${l.DrawerConstants.stringDisplay}`}edgeToStateToChangeTo(e){return`${e}${l.DrawerConstants.stringStateToChangeTo}`}openOrClosePopupDrawer(e,t){const s=r(this.getDrawerRef(e).current),a=D.getInstance(),n=this.getPopupServiceOptions(e,t);!1===this.isDrawerOpened(e)||this.shouldDrawerChangeDisplayMode(e)||this.getStateToChangeTo(e)?w.getStatus(s)===w.STATUS.OPEN&&a.close(n):this.isDrawerOpened(e)&&[w.STATUS.CLOSE,w.STATUS.UNKNOWN].indexOf(w.getStatus(s)>-1)&&a.open(n)}shouldDrawerChangeDisplayMode(e){return this.state[this.edgeToShouldChangeDisplayMode(e)]}getStateToChangeTo(e){return this.state[this.edgeToStateToChangeTo(e)]}getPopupServiceOptions(e,t){const s=r(this.getDrawerRef(e).current),a={},n=D.OPTION;a[n.POPUP]=s,a[n.LAUNCHER]=r(document.activeElement),a[n.LAYER_SELECTORS]=l.DrawerConstants.DrawerLayoutStyleSurrogate,a[n.LAYER_LEVEL]=D.LAYER_LEVEL.TOP_LEVEL,a[n.POSITION]=this.getDrawerPosition(e);const o=D.EVENT;return a[n.EVENTS]={[o.POPUP_BEFORE_OPEN]:()=>this.beforeOpenHandler(e,a),[o.POPUP_AFTER_OPEN]:()=>this.afterOpenHandler(e,t),[o.POPUP_BEFORE_CLOSE]:()=>this.beforeCloseHandler(e),[o.POPUP_AFTER_CLOSE]:()=>this.afterCloseHandler(e,t),[o.POPUP_REFRESH]:()=>{s.position(this.getDrawerPosition(e)),[l.DrawerConstants.stringStart,l.DrawerConstants.stringEnd].indexOf(e)>-1&&this.setStartEndOverlayDrawersHeight(),this.setBottomOverlayDrawerWidth()}},a}beforeOpenHandler(e,t){l.DrawerUtils.disableBodyOverflow();const s=t[D.OPTION.POPUP],r=t[D.OPTION.POSITION];return e===l.DrawerConstants.stringBottom&&this.setBottomOverlayDrawerWidth(),s.show(),s.position(r),this.setStartEndOverlayDrawersHeight(),this.animateOpen(e)}setBottomOverlayDrawerWidth(){if(this.isDrawerOpened(l.DrawerConstants.stringBottom)&&this.getDrawerResolvedDisplayMode(l.DrawerConstants.stringBottom)!=l.DrawerConstants.stringReflow){const e=this.middleSectionRef.current.getBoundingClientRect().width;this.bottomRef.current.style.width=e+"px"}}afterOpenHandler(e,t){l.DrawerUtils.enableBodyOverflow(),this.handleFocus(t);const s=r(this.getDrawerRef(e).current),a=w.getStatus(s);if(null===this.overlayDrawerResizeListener&&(this.overlayDrawerResizeListener=this.overlayDrawerResizeCallback.bind(this,e)),n.addResizeListener(this.getDrawerRef(e).current,this.overlayDrawerResizeListener,50,!0),a===w.STATUS.OPEN&&!this.isDrawerOpened(e)){const s=D.getInstance(),r=this.getPopupServiceOptions(e,t);s.close(r)}}handleFocus(e){this.state.startOpened&&e.startOpened!==this.state.startOpened&&this.setDrawerFocus(l.DrawerConstants.stringStart),this.state.endOpened&&e.endOpened!==this.state.endOpened&&this.setDrawerFocus(l.DrawerConstants.stringEnd),this.state.bottomOpened&&e.bottomOpened!==this.state.bottomOpened&&this.setDrawerFocus(l.DrawerConstants.stringBottom)}beforeCloseHandler(e){return l.DrawerUtils.disableBodyOverflow(),n.removeResizeListener(this.getDrawerRef(e).current,this.overlayDrawerResizeListener),this.overlayDrawerResizeListener,this.animateClose(e)}afterCloseHandler(e,t){this[this.edgeToClosedWithEsc(e)]&&(this[this.edgeToClosedWithEsc(e)]=!1),l.DrawerUtils.enableBodyOverflow();const s=r(this.getDrawerRef(e).current),a=w.getStatus(s);if(this.getDrawerRef(e).current&&this.getDrawerRef(e).current.removeAttribute("style"),this.getStateToChangeTo(e)){const t={},s={};s[this.edgeToStateToChangeTo(e)]=null,Object.assign(t,this.getStateToChangeTo(e),s),this.setState(t)}else if(this.shouldDrawerChangeDisplayMode(e)){const t={};t[this.edgeToShouldChangeDisplayMode(e)]=!1,t.viewportResolvedDisplayMode=this.getViewportResolvedDisplayMode(),this.setState(t)}else if(a===w.STATUS.CLOSE&&this.isDrawerOpened(e)){const s=D.getInstance(),r=this.getPopupServiceOptions(e,t);s.open(r)}else this.wasDrawerOpenedInPrevState(e)||this.forceUpdate()}setStartEndOverlayDrawersHeight(){const e=l.DrawerUtils.getElementHeight(this.middleSectionRef.current)+"px",t=this.startRef.current;t&&(t.style.height=e);const s=this.endRef.current;s&&(s.style.height=e)}},e.DrawerLayout.defaultProps={startOpened:!1,endOpened:!1,bottomOpened:!1,startDisplay:"auto",endDisplay:"auto",bottomDisplay:"auto"},e.DrawerLayout.metadata={slots:{"":{},start:{},end:{},bottom:{}},properties:{startOpened:{type:"boolean",writeback:!0},endOpened:{type:"boolean",writeback:!0},bottomOpened:{type:"boolean",writeback:!0},startDisplay:{type:"string",enumValues:["reflow","overlay","auto"]},endDisplay:{type:"string",enumValues:["reflow","overlay","auto"]},bottomDisplay:{type:"string",enumValues:["reflow","overlay","auto"]}},extension:{_WRITEBACK_PROPS:["startOpened","endOpened","bottomOpened"],_READ_ONLY_PROPS:[],_OBSERVED_GLOBAL_PROPS:["role"]}},e.DrawerLayout=d=h([t.customElement("oj-drawer-layout")],e.DrawerLayout),Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojdrawerlayout.js.map